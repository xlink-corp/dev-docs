# 生产管理（产量与批次）用户手册

本手册介绍“生产管理”模块中**生产基础配置（产品、生产单元）**、**生产批次**与**产量录入**的日常操作方法（仅描述 UI 功能，不包含 MES/接口对接说明）。

> 说明：产品的 PCF 相关字段（如“启用 PCF/功能单位”）在本手册仅做前置提示；请参阅《[产品碳足迹](./pcf-management.md)》了解详情。

---

## 1. 模块概述

### 1.1 功能定位

“生产管理”用于统一维护生产主数据并记录产量数据，主要服务于：

- 生产过程台账：批次维度的计划/执行信息沉淀
- 产量录入与追溯：按时间或按批次记录产量，支持导入导出
- 下游分析基础：为能耗单耗、对标分析、成本核算等模块提供关联口径（取决于系统已启用功能）

### 1.2 菜单页一览

| 页面 | 用途 |
|---|---|
| 生产基础配置 | 维护产品目录、生产单元（产线/单元）等主数据 |
| 生产批次 | 新建/维护批次，管理批次状态，查看批次汇总 |
| 产量录入 | 新建/维护产量记录，支持批次联动、导入与导出 |

### 1.3 核心概念

- **产品**：生产统计的对象，包含产品编码、名称、单位，以及（可选）标准能耗/标准工时等配置。
- **生产单元**：承载生产过程的组织单元（如产线/车间单元）。
- **生产批次**：生产执行的聚合容器，包含批次编码、计划时间/数量、状态等。
- **产量记录**：一条产量数据记录，可按即时/区间/批次等方式记录，并可关联到用能对象、产品、批次。

> 口径提示：批次页展示的“实际产量”通常来自产量记录的汇总/同步，可能存在刷新延迟；若刚录入产量请稍后刷新或等待列表自动更新。

---

## 2. 前置准备

在开始录入批次与产量前，建议先完成以下配置：

1. **选择组织**：确保当前在正确的组织/工厂空间下操作。
2. **维护产品目录**：至少包含“产品编码、产品名称、单位、启用状态”。
3. （可选）**维护用能对象**：如果你需要按用能对象统计/筛选产量，请先在“能源基础管理”中维护用能对象。
4. （可选）PCF：若产品需要进行碳足迹评估，启用 PCF 等字段请参考《[产品碳足迹](./pcf-management.md)》。

---

## 3. 快速入门（常见场景）

### 场景 A：创建批次并录入产量

1. 进入【生产批次】→ 点击【新建批次】。
2. 选择产品并填写计划信息（计划开始/结束、计划产量等）→ 保存。
3. 进入【产量录入】→ 点击【新建】。
4. 选择“批次/关联批次”（如界面提供）→ 系统会自动带出/锁定部分字段（例如产品、单位等）。
5. 输入产量与时间信息 → 保存。

### 场景 B：批量导入批次与产量

1. 在【生产批次】或【产量录入】页找到【导入】。
2. 先下载模板 → 按模板要求填写 → 再上传导入。
3. 导入完成后，在列表中检查新增/更新记录，并按需要导出留档。

### 场景 C：导出对账

1. 在【生产批次】页使用【导出】导出批次台账。
2. 在【产量录入】页使用【导出】导出产量明细。
3. 按时间范围或产品筛选后导出，可用于月度对账与归档。

---

## 4. 功能模块详解

## 4.1 生产基础配置
<img width="1710" height="778" alt="QQ_1769759134914" src="https://github.com/user-attachments/assets/42f8a925-ae33-460a-8943-cd41ac814e0e" />

本页面用于维护“生产相关主数据”。根据你的系统配置，可能包含多个 Tab；本手册覆盖：**产品目录**、**生产单元**（不包含班次日历）。

### 4.1.1 产品目录

常用操作：

- **新增产品**：填写产品编码、名称、单位等 → 保存。
- **编辑产品**：在列表中点击编辑 → 修改信息 → 保存。
- **启用/停用**：用于控制该产品是否可被批次/产量录入选择。
- **导入/导出**：用于批量维护产品主数据。

字段说明（常见）：

- **产品编码**：用于检索、导入匹配与批次编码生成。
- **产品名称**：列表显示与搜索。
- **单位**：产量单位（如 kg、t、pcs）。
- **标准能耗/标准工时**：用于后续对标或效率分析的基准值（仅主数据维护，本页不做分析计算）。
- **PCF 相关字段**：仅提示；如需配置与使用，请参阅《[产品碳足迹]》。

### 4.1.2 生产单元

常用操作：

- **新增生产单元**：填写编码、名称、描述、产能等 → 保存。
- **编辑生产单元**：在列表中修改信息 → 保存。
- **删除生产单元**：删除前请确认不再被产品/批次/产量引用（具体约束以系统提示为准）。
- **导入/导出**：批量维护生产单元。

字段说明（常见）：

- **编码/名称**：用于定位与下拉选择。
- **产能**：用于计划与分析的参考字段。
- **空间/区域**（如有）：用于与空间层级关联。

> 说明：若页面中存在“工序/流程”管理入口，请按页面提示在选定生产单元后进行新增/调整；其具体字段与校验以界面为准。

---

## 4.2 生产批次
<img width="1710" height="964" alt="QQ_1769759221229" src="https://github.com/user-attachments/assets/e7515e0a-715c-4a52-9b43-de99e23b2fb6" />

### 4.2.1 列表与筛选

批次列表通常支持：

- **状态筛选**（计划中/进行中/已完成/已取消）
- **按产品筛选**（选择产品或产品 ID）
- **搜索**（按批次编码/批次名称）
- **分页**（上一页/下一页或页码切换）

### 4.2.2 新建/编辑批次

常用字段：

- **批次编码**：支持自动生成，也可手动修改（以页面提示为准）。
- **批次名称**：可选，用于更易识别。
- **产品**：批次关联的产品。
- **用能对象**：可选，用于与能耗口径关联。
- **计划开始/结束时间**：计划窗口。
- **实际开始/结束时间**：执行时间（如页面提供）。
- **计划产量**：计划数量。
- **实际产量**：通常由产量记录汇总/同步而来，**不建议在批次表单中手工录入**（如界面不允许填写则忽略）。

> 批次编码生成：系统可能根据“产品编码 + 日期 + 序号”生成默认批次编码；若你手动覆盖，后续以手动值为准。

### 4.2.3 批次状态与按钮（仅状态与按钮说明）

批次状态及可用操作（以系统按钮/权限为准）：

- **planned（计划中）**：可操作 →【开始/置为进行中】、【取消】
- **in_progress（进行中）**：可操作 →【完成】、【取消】
- **completed（已完成）**：通常不可再变更
- **cancelled（已取消）**：可操作 →【重新计划/恢复为计划中】

#### 批量操作

在列表中勾选多条批次后，通常支持：

- **批量删除**：删除前请确认无保留需要。
- **批量更新状态**：选择目标状态 → 确认。

> 若你尝试将批次改为不允许的状态，系统会阻止（例如“已完成”通常不可再变更）。

### 4.2.4 批次详情（抽屉/详情面板）

点击批次行或“详情”后，通常会展示：

- 批次基本信息（产品、用能对象、时间、计划/实际）
- 关联产量记录列表或汇总信息
- 完成率/差异（如系统提供）

---

## 4.3 产量录入
<img width="1710" height="846" alt="QQ_1769759296984" src="https://github.com/user-attachments/assets/58afa581-bc58-4912-80f5-b59306d6da21" />

### 4.3.1 列表与筛选

产量列表通常支持：

- **按用能对象筛选**（如启用）
- **按产品筛选**
- **搜索**（产品编码/名称、批次编码/名称等）
- **分页与导出**

### 4.3.2 新建/编辑产量记录

常见录入要素：

- **产品**：必选/必填。
- **产量数值**：必填。
- **单位**：一般随产品决定（如可编辑，以页面为准）。
- **用能对象**：可选。
- **关联批次**：可选；选择批次后，系统可能会自动带出并锁定部分字段（例如产品、用能对象、单位或时间模式等）。

### 4.3.3 时间模式（以 UI 行为为准）

系统通常支持以下时间记录方式（名称以页面显示为准）：

- **即时（instant）**：记录一个时间点（如“发生时间”）。
- **区间（range）**：记录开始/结束时间（如“开始时间、结束时间”）。
- **批次（batch）**：与批次绑定；时间口径以批次信息为主（界面可能要求必须选择批次）。

### 4.3.4 导入/导出

- **导入**：按模板批量新增/更新产量记录；导入前建议先下载模板。
- **导出**：将当前筛选条件下的记录导出为 CSV（字段与顺序以导出文件为准）。

---

## 5. 导入模板与常见错误（速查）

> 导入校验规则以系统提示为准；以下为常见口径提醒。

### 5.1 生产批次导入（批次页）

常见必填字段：

- 批次编码
- 计划产量

常见可选字段：

- 产品编码
- 用能对象编码
- 计划/实际时间
- 状态

常见失败原因：

- 批次编码重复
- 产品编码/用能对象编码不存在
- 计划产量为空或 ≤ 0
- 状态值不在允许范围

### 5.2 产量录入导入（产量页）

常见必填字段：

- 产品编码
- 产量
- 时间（即时或区间字段，按模板要求）

常见可选字段：

- 用能对象编码
- 批次编码

常见失败原因：

- 产品编码不存在
- 批次编码不存在（当模板填写了批次编码时）
- 产量为空或 ≤ 0
- 时间格式无法解析

---

## 6. FAQ

### Q1：为什么批次的“实际产量”为空或未更新？

A：实际产量通常来自产量记录汇总/同步；请确认已新增产量记录且关联到该批次，并稍后刷新列表/等待自动刷新。

### Q2：为什么选择批次后，有些字段不能编辑？

A：系统会在“关联批次”场景下自动继承批次信息以保证口径一致（如产品、单位、用能对象或时间模式）。如需修改，请先取消关联批次或在批次信息中调整。

### Q3：导入提示“产品编码不存在/用能对象编码不存在”怎么办？

A：请先在对应主数据页面维护编码，并确保导入文件的编码与系统中完全一致（注意大小写、空格、前后缀）。

### Q4：为什么批次状态无法改成某些值？

A：系统限制了状态的可达性（例如“已完成”通常不可再变更）。请按页面按钮允许的操作进行变更。

### Q5：导出时间与本地时间显示不一致？

A：部分系统会以 UTC 存储/导出时间；请以你所在时区进行换算，或优先以系统页面展示为准。

---

## 7. 附录

### 7.1 批次状态字典

| 状态值 | 中文 | 常见按钮 |
|---|---|---|
| planned | 计划中 | 开始/置为进行中、取消 |
| in_progress | 进行中 | 完成、取消 |
| completed | 已完成 | （通常不可变更） |
| cancelled | 已取消 | 重新计划/恢复为计划中 |

### 7.2 批次编码示例

若系统启用自动生成，通常形如：

- `{产品编码}-{yyyyMMdd}-{序号}`

示例：

- `PRD001-20260123-01`

---

## 8. 版本历史

| 版本 | 日期 | 更新内容 |
|---|---|---|
| v1.0 | 2026-01 | 初始版本：生产基础配置（产品、生产单元）、生产批次、产量录入（含导入导出） |
